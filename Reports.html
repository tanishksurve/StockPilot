<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>StockPilot • Reports</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
  :root{
    --accent:#4534d9;
    --light-bg:#f5f7fb;
    --card-bg:#ffffff;
    --text:#1f2430;
    --muted:#6b7280;
    --radius:16px;
    --border:#e9edf3;
    --hover-bg:#f0f2ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Segoe UI',system-ui,Roboto,Arial,sans-serif;
    background:var(--light-bg); color:var(--text);
    display:flex; min-height:100vh;
  }

  /* ===== Sidebar (sticky, collapsible on hover for small) ===== */
  aside{
    width:220px; background:#fff; border-right:1px solid var(--border);
    position:fixed; inset:0 auto 0 0; z-index:1500; padding:20px 0;
    display:flex; flex-direction:column; justify-content:space-between;
    transition:width .3s ease; box-shadow:2px 0 10px rgba(0,0,0,.04);
  }
  .logo-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 0 20px 20px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 10px;
  }
  .logo {
    width: 55px;
    height: 55px;
    background-color: var(--accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
  }
  .logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 50%;
  }
  .logo-text {
    font-size: 20px;
    font-weight: 700;
    color: var(--accent);
    white-space: nowrap;
  }
  .side-top{display:flex; flex-direction:column; gap:18px}
  .side-item{
    display:flex; 
    align-items:center; 
    gap:12px; 
    padding:12px 24px; 
    color:var(--text); 
    text-decoration:none; 
    transition:all 0.2s ease;
    border-radius: 8px;
    margin: 0 10px;
  }
  .side-item i{
    min-width:20px; 
    text-align:center; 
    font-size:18px; 
    transition:.2s;
    color: #666;
  }
  .side-item:hover{
    background:var(--hover-bg);
  }
  .side-item:hover i {
    color: var(--accent);
  }
  .side-item:hover span {
    color: var(--accent);
  }
  .active{
    background:var(--hover-bg);
  }
  .active i, .active span{
    color:var(--accent);
    font-weight: 600;
  }
  .side-divider{border-top:1px solid var(--border); margin:10px 20px}

  /* ===== Main / Topbar ===== */
  main{flex:1; margin-left:220px; padding:30px; transition:margin-left .3s ease}
  header{display:flex; align-items:center; justify-content:space-between; margin-bottom:22px; gap:16px}
  .title{font-size:24px; font-weight:700; margin:0}
  .topbar-right{display:flex; align-items:center; gap:12px}
  .avatar{width:40px; height:40px; border-radius:50%; background:var(--accent); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700}

  /* Notifications */
  .notify{position:relative}
  .notify .bell{font-size:20px; cursor:pointer; position:relative}
  .badge{position:absolute; top:-6px; right:-6px; background:#f44336; color:#fff; width:18px; height:18px; border-radius:50%;
    font-size:10px; display:flex; align-items:center; justify-content:center}
  .panel{position:absolute; top:34px; right:0; width:340px; background:#fff; border-radius:12px;
    box-shadow:0 10px 24px rgba(0,0,0,.18); display:none; overflow:hidden; z-index:1600}
  .panel.show{display:block}
  .panel h4{margin:0; padding:12px 14px; border-bottom:1px solid var(--border)}
  .note{padding:12px 14px; border-bottom:1px solid var(--border)}
  .note .time{font-size:12px; color:var(--muted); margin-top:4px}
  .panel a{display:block; text-align:center; padding:10px; color:var(--accent); text-decoration:none}

  /* ===== Cards ===== */
  .card{
    background:#fff; border-radius:var(--radius); box-shadow:0 6px 18px rgba(17,24,39,.06);
    padding:18px; margin-top:16px; border:1px solid var(--border);
  }
  .card-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
  .card-title{font-weight:700; font-size:20px}
  .muted{color:var(--muted)}
  .icon-btn{
    width:34px; height:34px; border-radius:10px; border:1px solid var(--border); 
    background:#fff; color:#4b5563; display:inline-flex; align-items:center; 
    justify-content:center; cursor:pointer; transition:all 0.2s ease;
  }
  .icon-btn:hover{
    background:var(--accent); color:#fff; border-color:var(--accent);
  }
  .btn-primary{background:#5a49f2; color:#fff; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; min-width:220px}
  .input, .select{
    padding:12px 12px; border:1px solid var(--border); border-radius:12px; background:#fff; width:100%;
  }

  /* ===== Layout grids ===== */
  .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:18px; align-items:stretch}
  @media (max-width:1024px){ .grid-2{grid-template-columns:1fr} }
  .grid-params{display:grid; grid-template-columns:1fr 1fr auto; gap:14px}
  @media (max-width:800px){ .grid-params{grid-template-columns:1fr; } .btn-primary{min-width:unset; width:100%} }

  /* Chart containers to match image proportions */
  .chart-wrap{position:relative; height:360px;}           /* line chart */
  .donut-wrap{position:relative; height:360px; max-width:560px; margin:0 auto;} /* donut */
  .bar-wrap{position:relative; height:260px;}             /* bar */

  /* Top Products list */
  .top-products{display:flex; flex-direction:column; gap:14px}
  .tp-row{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px; border:1px solid var(--border); border-radius:12px; background:#fff}
  .tp-left{display:flex; gap:12px; align-items:center}
  .rank{width:34px; height:34px; background:#eef1ff; color:#5a49f2; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:800}
  .tp-name{font-weight:600}
  .tp-cat{font-size:12px; color:var(--muted)}
  .tp-right{text-align:right}
  .percent{font-weight:700}
  .up{color:#16a34a}
  .down{color:#ef4444}

  /* Table */
  .table-wrap{overflow:auto}
  table{width:100%; min-width:900px; border-collapse:collapse}
  th,td{padding:12px 14px; border-bottom:1px solid var(--border); text-align:left}
  th{background:#f7f9fc; font-size:13px; color:#4b5563}

  footer{color:#6b7280; text-align:center; margin-top:18px}

  /* Responsive sidebar behavior */
  @media (max-width: 992px){
    aside{width:60px; z-index:2000}
    .logo-container{flex-direction:column; padding:10px; gap:6px}
    .logo-text{display:none}
    aside h2, .side-item span{display:none}
    .side-item{justify-content:center; padding:14px; margin: 0 4px;}
    main{margin-left:60px}
    aside:hover, aside:focus-within{width:220px; box-shadow:2px 0 15px rgba(0,0,0,.12)}
    aside:hover .logo-text, aside:focus-within .logo-text{display:block}
    aside:hover h2, aside:hover .side-item span,
    aside:focus-within h2, aside:focus-within .side-item span{display:inline}
    aside:hover .side-item, aside:focus-within .side-item{justify-content:flex-start; padding:12px 24px; margin: 0 10px;}
    aside:hover .logo-container, aside:focus-within .logo-container{flex-direction:row; padding:0 20px 20px; gap:10px}
  }

  /* Print table only when pressing the table print */
  @media print{
    body *{visibility:hidden}
    #print-table, #print-table *{visibility:visible}
    #print-table{position:absolute; left:0; top:0; width:100%}
    @page{ margin:14mm }
  }
</style>
</head>
<body>

  <!-- ===== Sidebar ===== -->
  <aside>
    <div class="side-top">
      <div class="logo-container">
        <div class="logo"><img src="Logo.jpeg" alt="StockPilot Logo"></div>
        <div class="logo-text">StockPilot</div>
      </div>
      <a class="side-item" href="dashboard.html"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>
      <a class="side-item" href="inventory.html"><i class="fas fa-boxes"></i><span>Inventory</span></a>
      <a class="side-item" href="suppliers.html"><i class="fas fa-truck-loading"></i><span>Suppliers</span></a>
      <a class="side-item" href="orders.html"><i class="fas fa-shopping-cart"></i><span>Orders</span></a>
      <a class="side-item active" href="reports.html"><i class="fas fa-chart-pie"></i><span>Reports</span></a>
      <a class="side-item" href="settings.html"><i class="fas fa-cogs"></i><span>Settings</span></a>
    </div>
    <div>
      <div class="side-divider"></div>
      <a class="side-item" href="help.html"><i class="fas fa-question-circle"></i><span>Help & Docs</span></a>
    </div>
  </aside>

  <!-- ===== Main ===== -->
  <main>
    <!-- Topbar -->
    <header>
      <h1 class="title">Reports</h1>
      <div class="topbar-right">
        <div class="notify">
          <i class="fas fa-bell bell" id="bell"></i>
          <span class="badge" id="badge">3</span>
          <div class="panel" id="panel">
            <h4>Notifications</h4>
            <div class="note"><div>Monthly report generated.</div><div class="time">2h ago</div></div>
            <div class="note"><div>New category added: Food & Beverage.</div><div class="time">Yesterday</div></div>
            <a href="#">View All</a>
          </div>
        </div>
        <div class="avatar">TS</div>
      </div>
    </header>

    <!-- Report Parameters -->
    <section class="card">
      <div class="card-head">
        <div class="card-title">Report Parameters</div>
      </div>
      <div class="grid-params">
        <div>
          <label class="muted" for="startDate">Start Date</label>
          <input id="startDate" type="date" class="input"/>
        </div>
        <div>
          <label class="muted" for="endDate">End Date</label>
          <input id="endDate" type="date" class="input"/>
        </div>
        <div style="display:flex; align-items:flex-end">
          <button class="btn-primary" id="applyRange">Apply Date Range</button>
        </div>
      </div>
    </section>

    <!-- Row: Donut + Sales trend -->
    <section class="grid-2">
      <div class="card">
        <div class="card-head">
          <div class="card-title">Inventory Status</div>
          <button class="icon-btn" id="dlDonut" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="donut-wrap">
          <canvas id="donutChart" aria-label="Inventory Status"></canvas>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div class="card-title">Sales Trend</div>
          <button class="icon-btn" id="dlLine" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="chart-wrap">
          <canvas id="lineChart" aria-label="Sales Trend"></canvas>
        </div>
      </div>
    </section>

    <!-- Row: Top products + category chart -->
    <section class="grid-2">
      <div class="card">
        <div class="card-head">
          <div class="card-title">Top Products</div>
          <button class="icon-btn" id="dlTopProducts" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="top-products" id="topProducts">
          <!-- rows injected -->
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div class="card-title">Revenue by Category</div>
          <button class="icon-btn" id="dlBarChart" title="Download"><i class="fas fa-download"></i></button>
        </div>
        <div class="bar-wrap">
          <canvas id="barChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Inventory Value Report table -->
    <section class="card" id="print-table">
      <div class="card-head">
        <div class="card-title">Inventory Value Report</div>
        <div>
          <button class="icon-btn" id="exportCSV" title="Export CSV"><i class="fas fa-file-export"></i></button>
          <button class="icon-btn" id="exportPDF" title="Download PDF"><i class="fas fa-file-pdf"></i></button>
          <button class="icon-btn" id="printBtn" title="Print"><i class="fas fa-print"></i></button>
        </div>
      </div>
      <div class="table-wrap">
        <table id="valueTable">
          <thead>
            <tr>
              <th>CATEGORY</th>
              <th>TOTAL ITEMS</th>
              <th>IN STOCK VALUE</th>
              <th>AVERAGE COST</th>
              <th>PROFIT MARGIN</th>
              <th>TURNOVER RATE</th>
            </tr>
          </thead>
          <tbody id="valueBody">
            <!-- rows injected -->
          </tbody>
        </table>
      </div>
    </section>

    <footer>© 2025 StockPilot. All rights reserved.</footer>
  </main>

<script>
  /* ===== Notifications ===== */
  const bell = document.getElementById('bell');
  const panel = document.getElementById('panel');
  bell.addEventListener('click', (e)=>{ e.stopPropagation(); panel.classList.toggle('show'); });
  document.addEventListener('click', ()=> panel.classList.remove('show'));
  panel.addEventListener('click', (e)=> e.stopPropagation());

  /* ===== Mock data (replace with backend later) ===== */
  const salesByMonth = [
    {m:'Jan', v:12500},{m:'Feb',v:15000},{m:'Mar',v:14800},
    {m:'Apr',v:16500},{m:'May',v:18000},{m:'Jun',v:21200}
  ];
  const invStatus = { in: 420, low: 18, out: 6 };
  const topProducts = [
    {name:'Laptop Dell XPS 13', cat:'Electronics', amount:45240, change:+12.5},
    {name:'Office Chair', cat:'Furniture', amount:32180, change:+8.3},
    {name:'Wireless Mouse', cat:'Electronics', amount:28350, change:+5.7},
    {name:'Desk Lamp', cat:'Furniture', amount:21420, change:-2.1},
    {name:'HDMI Cable', cat:'Electronics', amount:18760, change:+3.4},
  ];
  const categories = [
    {name:'Electronics', value:45000},
    {name:'Furniture', value:31500},
    {name:'Office Supplies', value:28400},
    {name:'Clothing', value:21000},
    {name:'Food', value:19000},
  ];
  const valueRows = [
    {cat:'Electronics', items:450, stock:125750, avg:279.44, margin:'35.2%', turn:'4.8x'},
    {cat:'Furniture', items:320, stock:98400, avg:307.50, margin:'28.5%', turn:'3.2x'},
    {cat:'Office Supplies', items:280, stock:42000, avg:150.00, margin:'42.1%', turn:'5.6x'},
    {cat:'Clothing', items:150, stock:45000, avg:300.00, margin:'30.0%', turn:'4.1x'},
  ];

  /* ===== Utilities ===== */
  const fmtMoney = n => '$' + n.toLocaleString(undefined,{maximumFractionDigits:0});
  const downloadChart = (canvasId, fileName) => {
    const link = document.createElement('a');
    link.download = fileName;
    link.href = document.getElementById(canvasId).toDataURL('image/png');
    link.click();
  };

  /* ===== Charts ===== */
  let donutChart, lineChart, barChart;

  function buildDonut(){
    const ctx = document.getElementById('donutChart').getContext('2d');
    if(donutChart) donutChart.destroy();
    donutChart = new Chart(ctx, {
      type:'doughnut',
      data:{
        labels:['In Stock','Low Stock','Out of Stock'],
        datasets:[{
          data:[invStatus.in, invStatus.low, invStatus.out],
          backgroundColor:['#69c48a','#f9b54c','#ef5350'],
          hoverOffset:4,
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        cutout:'62%',
        plugins:{
          legend:{position:'bottom', labels:{usePointStyle:true, boxWidth:12}},
          tooltip:{callbacks:{label:(ctx)=>`${ctx.label}: ${ctx.raw}`}}
        }
      }
    });
  }

  function buildLine(){
    const ctx = document.getElementById('lineChart').getContext('2d');
    if(lineChart) lineChart.destroy();
    lineChart = new Chart(ctx, {
      type:'line',
      data:{
        labels:salesByMonth.map(x=>x.m),
        datasets:[{
          label:'Sales',
          data:salesByMonth.map(x=>x.v),
          borderColor:'#5a49f2',
          pointBackgroundColor:'#5a49f2',
          fill:true,
          backgroundColor:'rgba(90,73,242,0.12)',
          tension:.35
        }]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        scales:{
          y:{ticks:{callback:(v)=>'$'+v.toLocaleString()} }
        },
        plugins:{legend:{display:false}}
      }
    });
  }

  function buildBar(){
    const ctx = document.getElementById('barChart').getContext('2d');
    if(barChart) barChart.destroy();
    barChart = new Chart(ctx, {
      type:'bar',
      data:{
        labels:categories.map(c=>c.name),
        datasets:[{
          label:'Revenue',
          data:categories.map(c=>c.value),
          backgroundColor:['#6c7cff','#4cc9a6','#f7b267','#ef7b7b','#6ea0ff']
        }]
      },
      options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{legend:{display:false}},
        scales:{y:{ticks:{callback:(v)=>'$'+v.toLocaleString()}}}
      }
    });
  }

  /* ===== Top products list ===== */
  function renderTopProducts(){
    const list = document.getElementById('topProducts');
    list.innerHTML = topProducts.map((p, i)=>`
      <div class="tp-row">
        <div class="tp-left">
          <div class="rank">${i+1}</div>
          <div>
            <div class="tp-name">${p.name}</div>
            <div class="tp-cat">${p.cat}</div>
          </div>
        </div>
        <div class="tp-right">
          <div style="font-weight:700">${fmtMoney(p.amount)}</div>
          <div class="percent ${p.change>=0?'up':'down'}">${p.change>0?'+':''}${p.change}%</div>
        </div>
      </div>
    `).join('');
  }

  /* ===== Inventory value table ===== */
  function renderTable(){
    const body = document.getElementById('valueBody');
    body.innerHTML = valueRows.map(r=>`
      <tr>
        <td>${r.cat}</td>
        <td>${r.items}</td>
        <td>${fmtMoney(r.stock)}</td>
        <td>${fmtMoney(r.avg)}</td>
        <td>${r.margin}</td>
        <td>${r.turn}</td>
      </tr>
    `).join('');
  }

  /* ===== Actions ===== */
  document.getElementById('dlDonut').addEventListener('click', ()=> downloadChart('donutChart','Inventory-Status.png'));
  document.getElementById('dlLine').addEventListener('click', ()=> downloadChart('lineChart','Sales-Trend.png'));
  document.getElementById('dlBarChart').addEventListener('click', ()=> downloadChart('barChart','Revenue-by-Category.png'));
  
  document.getElementById('dlTopProducts').addEventListener('click', ()=>{
    const header = ['Rank', 'Product Name', 'Category', 'Amount', 'Change'];
    const rows = topProducts.map((p, i) => [
      i+1, 
      p.name, 
      p.cat, 
      fmtMoney(p.amount), 
      `${p.change>0?'+':''}${p.change}%`
    ]);
    let csv = header.join(',')+'\n'+rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob); 
    const a = document.createElement('a');
    a.href = url; 
    a.download = 'Top-Products.csv'; 
    a.click(); 
    URL.revokeObjectURL(url);
  });

  document.getElementById('exportCSV').addEventListener('click', ()=>{
    const header = ['CATEGORY','TOTAL ITEMS','IN STOCK VALUE','AVERAGE COST','PROFIT MARGIN','TURNOVER RATE'];
    const rows = valueRows.map(r=>[r.cat,r.items,r.stock,r.avg,r.margin,r.turn]);
    let csv = header.join(',')+'\n'+rows.map(r=>r.join(',')).join('\n');
    const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='Inventory-Value-Report.csv'; a.click(); URL.revokeObjectURL(url);
  });

  document.getElementById('exportPDF').addEventListener('click', ()=>{
    const { jsPDF } = window.jspdf; 
    const doc = new jsPDF();
    doc.setFontSize(16); 
    doc.text('Inventory Value Report', 14, 18);
    const head = [['Category', 'Items', 'Stock Value', 'Avg Cost', 'Margin', 'Turnover']];
    const body = valueRows.map(r => [
      r.cat, 
      r.items, 
      fmtMoney(r.stock), 
      fmtMoney(r.avg), 
      r.margin, 
      r.turn
    ]);
    doc.autoTable({ 
      head, 
      body, 
      startY: 26, 
      styles: { fontSize: 10, cellPadding: 2 }, 
      headStyles: { fillColor: [69, 52, 217], textColor: 255 } 
    });
    doc.save('Inventory-Value-Report.pdf');
  });

  document.getElementById('printBtn').addEventListener('click', ()=> window.print());

  /* Date range apply (demo: filters last n months if range shorter) */
  const startDate = document.getElementById('startDate');
  const endDate = document.getElementById('endDate');
  // defaults: previous month to today
  const dNow = new Date();
  endDate.valueAsDate = dNow;
  const dStart = new Date(dNow); dStart.setMonth(dNow.getMonth()-1);
  startDate.valueAsDate = dStart;

  document.getElementById('applyRange').addEventListener('click', ()=>{
    const s = startDate.valueAsDate, e = endDate.valueAsDate;
    if(!s || !e || s>e){ alert('Choose a valid date range.'); return; }
    const diffDays = Math.max(1, Math.round((e-s)/(1000*60*60*24)));
    // Simple demo behavior: shorten/lengthen sales series based on days
    const count = Math.min(salesByMonth.length, Math.max(3, Math.round(diffDays/10)));
    const trimmed = salesByMonth.slice(-count);
    lineChart.data.labels = trimmed.map(x=>x.m);
    lineChart.data.datasets[0].data = trimmed.map(x=>x.v);
    lineChart.update();
  });

  /* ===== Init ===== */
  function init(){
    renderTopProducts();
    renderTable();
    buildDonut();
    buildLine();
    buildBar();
  }
  init();
</script>
</body>
</html>